<html>
  <head>
    <script type="text/javascript" src="/tap/shared.js"></script>
    <script type="text/javascript" src="/tap/client.js"></script>
    <script type="text/javascript" src="/snake.js"></script>
    <script type="text/javascript" src="/socket.io/socket.io.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script>
      $(function(){
        var socket = io.connect(window.location.origin);

        // Set the engine to be used.
        tapio.Engine.setExtension(new tapio.SnakeExtension());
        
        // Create the client Game object to get the system off and running.
        var game = new tapio.Game(socket);
        
        $(document).on('keyup', function(event){
          switch(event.which){
            case 37:
              game.send({type: tapio.Events.CUSTOM, data: {type: 'left'}});
              break;
            case 38:
              game.send({type: tapio.Events.CUSTOM, data: {type: 'up'}});
              break;
            case 39:
              game.send({type: tapio.Events.CUSTOM, data: {type: 'right'}});
              break;
            case 40:
              game.send({type: tapio.Events.CUSTOM, data: {type: 'down'}});
              break;
            case 82:
              game.send({type: tapio.Events.CUSTOM, data: {type: 'respawn'}});
              break;
          }
        });

        var canvas = document.getElementById('snakecanvas');
        var context = canvas.getContext('2d');

        var SnakeRenderer = function(){}
        SnakeRenderer.prototype.render = function(sessionId, state){
          for(var otherSessionId in state.players){
            var player = state.players[otherSessionId];
            if(player.snake){
              context.beginPath();
              context.moveTo(player.snake.x, player.snake.y);
              var segments = player.snake.getSegments();
              for(var i = 0; i < segments.length; i++){
                var segment = segments[i];
                context.lineTo(segment.x2, segment.y2);
              }
              context.stroke();
            }
          }
        };

        var renderLoop = new tapio.RenderLoop(game, new SnakeRenderer());
      });
    </script>
  </head>
  <body>
    <canvas id="snakecanvas" height="200" width="200"></canvas>
  </body>
</html>
